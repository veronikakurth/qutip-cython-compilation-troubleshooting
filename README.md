# About

This repository aims to present a containerized setup for isolated builds of QuTiP in editable and wheels install. 
In the editable install, we aim to reproduce the issue with runtime compilation of strings pointed in [String compilation fails in editable install #2770](https://github.com/qutip/qutip/issues/2770).

# Base image

Defined in `Dockerfile`. Built on top of `continuumio/miniconda3:latest` base image - Debian + Conda.
Creates a virtual Conda environment with dependencies required for QuTiP installation (see `environment.yml`).
Clones QuTiP repository. 

# Available containers

In `docker-compose.yml`, the following containers are declared and defined:
1. `editable` - editable installation of QuTiP (important to reproduce the issue)
2. `editable-fix` - editable installation of QuTiP with the proposed fix
3. `wheel` - wheel installation of QuTiP
4. `wheel-fix` - wheel installation of QuTiP with the proposed fix

All of them use the same image but are isolated from each other during execution.

You can run each separate container as a service via:

```
docker compose up <name> --build
```

# Other files
## Python scripts
1. `coefficient.py` - a copy of `qutip/core/coefficient.py` from latest master branch (commit hash) with monkey patching of Cython's `Compiler.Main.search_include_directories` function with verbose logs for troubleshooting. Used by `editable` and `wheel` containers to help us investigate how Cython discovers `.pxd` files. 
2. `coefficient_fix.py` - same as `coefficient.py` but with the proposed fix to `cythonize` function's usage. Used by `editable-fix` and `wheel-fix` containers. 
3. `reproduce.py` - a minimal example of how to reproduce the issue with runtime compilation. 

## Logs
1. `runtime_logs_edit.log` - generated by `editable` container.
2. `runtime_logs_wheel.log` - by `wheel` container. 
3. `runtime_logs_edit_fix.log` - by `editable-fix` container.
4. `runtime_logs_wheel_fix.log` - by `wheel-fix` container.

